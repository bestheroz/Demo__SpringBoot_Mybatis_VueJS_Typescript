<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.github.bestheroz.sample.api.menu.MenuDAO">
    <select id="getList" resultType="MenuVO" parameterType="String">
        SELECT A.* FROM (
        SELECT 1 LEVEL ,
        M.ID ,
        M.NAME,
        M.TYPE,
        M.PARENT_ID,
        M.DISPLAY_ORDER,
        M.URL,
        M.ICON,
        M.UPDATED,
        M.UPDATED_BY
        FROM MENU M
        <where>
            AND M.ID = 1
        </where>
        UNION ALL
        SELECT 2 LEVEL ,
        M.ID ,
        M.NAME,
        M.TYPE,
        M.PARENT_ID,
        M.DISPLAY_ORDER,
        M.URL,
        M.ICON,
        M.UPDATED,
        M.UPDATED_BY
        FROM MENU M
        <if test="authority != 999">
        JOIN MENU_AUTHORITY MA ON INSTR(MA.MENU_ID_LIST, CONCAT('^|', M.ID, ',')) > 0
        </if>
        <where>
            AND M.PARENT_ID = 1
            <if test="authority != 999">
            AND MA.AUTHORITY = #{authority, jdbcType=INTEGER}
            </if>
        </where>
        UNION ALL
        SELECT 3 LEVEL ,
        M2.ID ,
        M2.NAME,
        M2.TYPE,
        M2.PARENT_ID,
        M2.DISPLAY_ORDER,
        M2.URL,
        M2.ICON,
        M2.UPDATED,
        M2.UPDATED_BY
        FROM MENU M JOIN MENU M2 ON M2.PARENT_ID = M.ID
        <if test="authority != 999">
        JOIN MENU_AUTHORITY MA ON INSTR(MA.MENU_ID_LIST, CONCAT('^|', M2.ID, ',')) > 0
        </if>
        <where>
            AND M.PARENT_ID = 1
            <if test="authority != 999">
            AND MA.AUTHORITY = #{authority, jdbcType=INTEGER}
            </if>
        </where>
        ) A
        ORDER BY A.LEVEL, A.DISPLAY_ORDER, A.NAME
    </select>
</mapper>

